<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>vectr-lab Backtest Report</title>
    <style>
      body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif; margin: 40px; }
      h1, h2 { color: #222; }
      table { border-collapse: collapse; width: 100%; margin-bottom: 1.5rem; }
      th, td { padding: 8px 12px; border-bottom: 1px solid #eee; text-align: left; }
      .metric-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 12px; }
      .metric-card { background: #f7f8fa; padding: 12px; border-radius: 6px; }
      .charts { display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 24px; }
    </style>
  </head>
  <body>
    <h1>vectr-lab Backtest Report</h1>
    <p>Generated at {{ generated_at }}</p>

    <h2>Key Metrics</h2>
    <div class="metric-grid">
      {% for key, value in metrics.items() %}
      <div class="metric-card">
        <div><strong>{{ key.replace('_', ' ').title() }}</strong></div>
        <div>{{ '{:.4f}'.format(value) if value is not none else 'n/a' }}</div>
      </div>
      {% endfor %}
    </div>

    {% if per_ticker %}
    <h2>Per Ticker</h2>
    <table>
      <thead>
        <tr>
          {% for key in per_ticker[0].keys() %}
          <th>{{ key.replace('_', ' ').title() }}</th>
          {% endfor %}
        </tr>
      </thead>
      <tbody>
        {% for row in per_ticker %}
        <tr>
          {% for value in row.values() %}
          <td>{{ value }}</td>
          {% endfor %}
        </tr>
        {% endfor %}
      </tbody>
    </table>
    {% endif %}

    <h2>Charts</h2>
    <div class="charts">
      <div>{{ equity_html | safe }}</div>
      <div>{{ drawdown_html | safe }}</div>
      <div>{{ contribution_html | safe }}</div>
    </div>
  </body>
</html>
